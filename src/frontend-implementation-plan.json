{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Deterministic Conversation Practice mode (chat UI + tutor feedback)",
  "requirements": [
    {
      "id": "REQ-10",
      "summary": "Add a new authenticated Conversation Practice route with deterministic turn-based chat generated from the user’s vocabulary (no external APIs).",
      "acceptanceCriteria": [
        "A new route exists at \"/conversation\" and is protected by the existing AuthGate behavior (unauthenticated users see the landing experience).",
        "The Conversation page provides a chat-style UI with a clear start/reset flow and a visible indication of whose turn it is (Learner vs Partner).",
        "Conversation prompts and expected responses are generated deterministically from the user’s vocabulary (and optional notes), without calling any external APIs.",
        "When vocabulary is empty, the Conversation page shows an actionable empty state linking to \"/vocabulary\"."
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/ConversationPage.tsx",
          "operation": "create",
          "description": "Create the Conversation Practice page UI: wrap content in the existing AuthGate (from the authorization component) so unauthenticated users see the landing experience; fetch vocabulary via existing query hooks; implement a chat-style, turn-based flow with Start/Reset controls, visible turn indicator (Learner vs Partner), deterministic prompt generation from vocabulary + optional notes, and an empty state that links to \"/vocabulary\" when vocabulary is empty. Verify the component's usage instructions before implementing."
        },
        {
          "path": "frontend/src/utils/conversation/generateConversationTurns.ts",
          "operation": "create",
          "description": "Add deterministic (non-random) conversation-turn generation utilities that derive partner prompts and expected learner replies from the current vocabulary list (and item notes when present), using stable selection (e.g., sorted item ids + turn index) and local-only logic (no external calls)."
        },
        {
          "path": "frontend/src/App.tsx",
          "operation": "modify",
          "description": "Register the new \"/conversation\" route in the TanStack Router route tree and wire it to ConversationPage so it is navigable."
        }
      ]
    },
    {
      "id": "REQ-11",
      "summary": "Expose Conversation Practice entry points in top navigation (desktop/mobile) and on the dashboard.",
      "acceptanceCriteria": [
        "Top navigation includes a new link labeled \"Conversation\" that routes to \"/conversation\" and shows an active state when selected (desktop and mobile nav).",
        "Dashboard includes a new quick action card/button that links to \"/conversation\" alongside the existing Practice and Vocabulary actions."
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/nav/TopNav.tsx",
          "operation": "modify",
          "description": "Add a new nav item labeled \"Conversation\" pointing to \"/conversation\" (including an icon) and ensure it uses the existing active-state logic for both desktop and mobile nav variants."
        },
        {
          "path": "frontend/src/pages/DashboardPage.tsx",
          "operation": "modify",
          "description": "Add a new quick action card/button linking to \"/conversation\" alongside the existing Practice Session and Vocabulary actions, matching the current dashboard card styling."
        }
      ]
    },
    {
      "id": "REQ-12",
      "summary": "Evaluate each learner turn with deterministic tutor feedback and submit pass/fail via the existing submitPracticeResult flow tied to the vocabulary item used for that turn.",
      "acceptanceCriteria": [
        "After the user sends a message, the UI evaluates the user message against one or more acceptable expected replies using deterministic matching (reusing the existing tutor feedback approach).",
        "The user sees feedback in-app (correct/incorrect + hint/suggestion) consistent with the current TutorPanel style and copy tone (English).",
        "Each conversation turn is associated with a specific vocabulary item used to generate that turn, and the app submits pass/fail using the existing submit practice result mutation so vocab stats/lastSeen update accordingly.",
        "No new backend methods are required for this feature (it must work using existing queries/mutations and local UI state)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/utils/tutor/feedback.ts",
          "operation": "modify",
          "description": "Extend deterministic tutor feedback generation to support evaluating a user reply against multiple acceptable expected answers (while keeping the current hint/suggestion tone in English), reusing the existing normalization + typo-tolerance approach."
        },
        {
          "path": "frontend/src/pages/ConversationPage.tsx",
          "operation": "modify",
          "description": "Implement per-turn evaluation and tutor feedback display: after the learner sends a message, compute pass/fail using deterministic matching against one or more acceptable expected replies, render feedback using the existing TutorPanel style, associate the turn to the vocabulary item that generated it, and submit pass/fail through the existing useSubmitPracticeResult mutation; keep full transcript in local UI state only (no backend persistence)."
        }
      ]
    }
  ]
}